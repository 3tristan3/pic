<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片处理工作台</title>
    
    <!-- 引入样式 -->
    <link rel="stylesheet" href="style.css">
    
    <!-- 第三方库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <!-- 统计脚本 (放在头部的兼容性更好) -->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>
<body>

<!-- 主题切换器 -->
<div class="theme-dropdown">
    <button class="theme-toggle-btn" id="btn-theme-toggle">
        💻 跟随系统 <!-- 默认文字 -->
    </button>
    <div class="theme-menu" id="theme-menu">
        <div class="theme-option" data-mode="light">☀️ 浅色模式</div>
        <div class="theme-option" data-mode="dark">🌙 深色模式</div>
        <div class="theme-option" data-mode="system">💻 跟随系统</div>
    </div>
</div>


<!-- 主容器 (白色卡片) -->
<div class="container">
    
    <div class="header">
        <h1>图片处理工作台</h1>
        <div class="subtitle">Image Processing Workbench</div>
    </div>

    <!-- 导航栏 -->
    <div class="tabs">
        <button class="tab-btn active" data-target="tab-resize">📉 图片压缩</button>
        <button class="tab-btn" data-target="tab-convert">🔄 格式转换</button>
        <button class="tab-btn" data-target="tab-upscale">🔍 图片放大</button>
        <button class="tab-btn" data-target="tab-canvas">✂️ 图片裁剪</button>
        <button class="tab-btn" data-target="tab-stitch">🖼️ 长图拼接</button>
    </div>

    <div class="workspace">
        
        <!-- 模块 1: 图片压缩 -->
        <div id="tab-resize" class="tool-section active">
            <div class="control-row">
                <div class="input-group">
                    <label>1. 图片管理</label>
                    <div class="fake-file-btn" id="btn-open-modal">
                        📂 管理图片库 (<span id="file-count-label">0</span>)
                    </div>
                </div>
                <div class="input-group">
                    <label>2. 目标大小 (KB)</label>
                    <input type="number" id="resize-target" value="100" min="10">
                </div>
                <div class="input-group" style="flex: 0;">
                    <label>&nbsp;</label>
                    <button class="action-btn" id="btn-run-resize">开始处理</button>
                </div>
            </div>
            <div style="font-size: 12px; color: var(--text-sub); text-align:center;">
                ℹ️ 说明：在弹窗中添加图片。若只有1张则生成预览；若多张则自动打包下载 ZIP。
            </div>
            <div id="batch-progress" style="display:none; margin-top:15px; background:var(--bg-hover); border-radius:4px; padding:10px; text-align:center;">
                <span style="color:var(--primary); font-weight:bold; font-size:14px;">📦 正在批量处理: <span id="batch-count">0/0</span></span>
            </div>
        </div>

        <!-- 模块 2: 格式转换 -->
        <div id="tab-convert" class="tool-section">
            <div class="control-row">
                <div class="input-group">
                    <label>1. 选择图片</label>
                    <div class="file-wrapper">
                        <input type="file" id="convert-file" accept="image/*">
                        <div class="file-clear-btn" onclick="clearInput('convert-file')">×</div>
                    </div>
                </div>
                <div class="input-group">
                    <label>2. 目标格式</label>
                    <select id="convert-format">
                        <option value="image/jpeg" selected>JPG (通用)</option>
                        <option value="image/png">PNG (透明/无损)</option>
                        <option value="image/webp">WebP (小体积)</option>
                    </select>
                </div>
                <div class="input-group" style="flex: 0;">
                    <label>&nbsp;</label>
                    <button class="action-btn" id="btn-run-convert">开始转换</button>
                </div>
            </div>
        </div>

        <!-- 模块 3: 图片放大 -->
        <div id="tab-upscale" class="tool-section">
            <div class="control-row">
                <div class="input-group">
                    <label>1. 选择图片</label>
                    <div class="file-wrapper">
                        <input type="file" id="upscale-file" accept="image/*">
                        <div class="file-clear-btn" onclick="clearInput('upscale-file')">×</div>
                    </div>
                </div>
                <div class="input-group">
                    <label>2. 放大倍数</label>
                    <select id="upscale-factor">
                        <option value="1.5">1.5x (轻微)</option>
                        <option value="2.0" selected>2.0x (双倍)</option>
                        <option value="3.0">3.0x (强力)</option>
                    </select>
                </div>
                <div class="input-group" style="flex: 0;">
                    <label>&nbsp;</label>
                    <button class="action-btn" id="btn-run-upscale">开始放大</button>
                </div>
            </div>
        </div>

        <!-- 模块 4: 图片裁剪 -->
        <div id="tab-canvas" class="tool-section">
            <div class="control-row crop-grid">
                <div class="input-group">
                    <label>1. 上传图片</label>
                    <div class="file-wrapper">
                        <input type="file" id="crop-file" accept="image/*">
                        <div class="file-clear-btn" onclick="clearInput('crop-file')">×</div>
                    </div>
                </div>
                <div class="input-group">
                    <label>2. 输出格式</label>
                    <select id="crop-format">
                        <option value="image/jpeg" selected>JPG</option>
                        <option value="image/png">PNG</option>
                        <option value="image/webp">WebP</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>3. 设定比例</label>
                    <div class="btn-group">
                        <button class="ratio-btn active" data-ratio="NaN">自由</button>
                        <button class="ratio-btn" data-ratio="1">1:1</button>
                        <button class="ratio-btn" data-ratio="1.7777">16:9</button>
                        <button class="ratio-btn" data-ratio="1.3333">4:3</button>
                    </div>
                </div>
                <div class="input-group">
                    <label>&nbsp;</label>
                    <button class="action-btn" id="btn-run-crop">✂️ 确认裁剪</button>
                </div>
            </div>
            <div id="crop-editor-container" style="display:none; margin-top: 20px;">
                <div style="height: 400px; background: var(--cropper-bg); border-radius: 8px; overflow: hidden; display:flex; justify-content:center; align-items:center;">
                    <img id="crop-image-source" style="max-width: 100%; display: block;">
                </div>
                <div style="font-size: 12px; color: var(--text-sub); margin-top: 8px; text-align: center;">💡 提示：拖动白色边框调整大小，拖动中间移动选区，支持鼠标滚轮缩放。</div>
            </div>
        </div>

        <!-- 模块 5: 长图拼接 -->
        <div id="tab-stitch" class="tool-section">
            <div class="control-row">
                <div class="input-group">
                    <label>1. 选择多张图片</label>
                    <div class="file-wrapper">
                        <input type="file" id="stitch-files" accept="image/*" multiple>
                        <div class="file-clear-btn" onclick="clearInput('stitch-files')">×</div>
                    </div>
                </div>
                <div class="input-group">
                    <label>2. 拼接模式</label>
                    <select id="stitch-mode">
                        <option value="vertical" selected>⬇️ 竖向拼接</option>
                        <option value="horizontal">➡️ 横向拼接</option>
                        <option value="grid">🪟 宫格拼接</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>3. 间距</label>
                    <select id="stitch-gap">
                        <option value="0" selected>无间距</option>
                        <option value="10">10px</option>
                        <option value="20">20px</option>
                    </select>
                </div>
                <div class="input-group" style="flex: 0;">
                    <label>&nbsp;</label>
                    <button class="action-btn" id="btn-run-stitch">开始拼接</button>
                </div>
            </div>
            <div id="stitch-container" style="display:none; margin-top:20px;">
                <div class="stitch-sort-area" id="stitch-sort-list"></div>
                <div style="text-align:center; margin:10px 0; color:#999; font-size:12px;">(可拖动图片调整顺序)</div>
            </div>
        </div>

        <!-- 公用状态区 -->
        <div id="loading" class="loading">⏳ 正在处理中...</div>
        <div id="preview-area" class="preview-area" style="display: none;">
            <div class="preview-card" id="card-orig">
                <div class="stats" id="stats-orig"></div>
                <div class="img-box"><img id="img-orig" src=""></div>
                <div class="label-text">原始图片</div>
            </div>
            <div class="preview-card" id="card-res">
                <div class="stats" id="stats-res"></div>
                <div class="img-box success-border"><img id="img-res" src=""></div>
                <div class="label-text success-text">处理结果</div>
                <a id="btn-download" class="download-btn">⬇️ 下载文件</a>
            </div>
        </div>

    </div>

    <!-- === 这里是 Footer  === -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-item">
                <span id="greeting-text">👋 您好</span>
                <span class="divider">|</span>
                <span>🚀 稳定运行 <strong id="run-time">...</strong></span>
            </div>
            <div class="footer-item stats-badge">
                <span>👀 浏览量<span id="busuanzi_value_site_pv" class="num-highlight">...</span></span>
                <span class="divider">/</span>
                <span>👤 访客数<span id="busuanzi_value_site_uv" class="num-highlight">...</span></span>
            </div>
        </div>
        <div class="copyright">
            &copy; 2026 Image Processing Workbench. All rights reserved.
        </div>
    </footer>

</div> <!-- Container 结束 -->

<!-- 弹窗 -->
<div class="modal-overlay" id="upload-modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">图片批量管理</div>
            <div class="modal-close" id="btn-close-modal-x">×</div>
        </div>
        <div class="modal-body">
            <div class="upload-grid" id="thumb-grid">
                <div class="upload-add-btn" id="btn-add-files">
                    <span style="font-size:24px;">+</span>
                    <span style="font-size:12px; margin-top:5px;">添加图片</span>
                </div>
            </div>
            <input type="file" id="real-file-input" accept="image/*" multiple style="display:none">
        </div>
        <div class="modal-footer">
            <button class="ratio-btn" id="btn-clear-all" style="color:#ef4444; border-color:#ef4444; flex:0 0 auto;">🗑️ 清空全部</button>
            <div style="flex:1"></div>
            <button class="ratio-btn" id="btn-close-modal" style="flex:0 0 100px;">关闭</button>
            <button class="action-btn" id="btn-confirm-modal" style="width:auto; padding:0 30px;">确认并返回</button>
        </div>
    </div>
</div>

<!-- 核心脚本 (一定要在最后) -->
<script type="module" src="./js/main.js"></script>
</body>
</html>
